@page "/bookmark"
@attribute [Authorize(Roles = "Author,Admin")]

   
            <div class="p-5 h-screen overflow-auto">
                <h2 class="text-lg font-bold mb-6 text-gray-700">BookMarks</h2>
                <section class="pt-5 border-t-1 border-gray-300">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                        @if (PostDtos != null && PostDtos.Any())
                        {
                            foreach (var bookmark in PostDtos)
                            {
                                <article class="bg-white rounded-2xl p-6 border border-gray-200 hover:-translate-y-1 hover:shadow-xl hover:border-blue-600 transition-all cursor-pointer">
                                    <div class="flex justify-between items-center mb-4">
                                        <span class="bg-blue-50 text-blue-600 px-3 py-1.5 rounded-md text-xs font-semibold uppercase">@bookmark.CategoryName</span>
                                        <button @onclick="() => HandleBookMark(bookmark.Id)"
                                                class="p-2 cursor-pointer rounded-lg transition-colors @(bookmark.IsBookMark ? "bg-indigo-50 text-indigo-600" : "bg-gray-100 text-gray-600 hover:bg-gray-200")">
                                            <svg class="w-5 h-5 @(bookmark.IsBookMark ? "fill-current" : "")" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" />
                                            </svg>
                                        </button>
                                    </div>
                                    <h3 class="text-xl font-bold mb-3 text-gray-700 leading-snug">
                                        @bookmark.Title
                                    </h3>
                                    <div class="prose prose-sm max-w-none line-clamp-3 mb-4 [&_*]:!text-sm">
                                        @((MarkupString)bookmark.Content!)
                                    </div>
                                    <div class="flex justify-between items-center pt-4 border-t border-gray-200">
                                        <span class="text-sm text-gray-600">⏱️ @bookmark.readingDuration.GetDisplayName()</span>
                                        <NavLink href="admin/create-blog" class="text-blue-600 font-semibold text-sm hover:underline">Read more →</NavLink>
                                    </div>
                                </article>
                            }
                        }
                        else
                        {
                            <p>Loading bookmarks...</p>
                        }
                    </div>
                </section>
            </div>
      
          
  
@code {
    private List<PostDto>? PostDtos { get; set; }
    private AddBookMarkRequest addBookMarkRequest { get; set; } = new();
    private bool _isAuthChecked = false;
    private bool hasrender = false;
    protected override async Task OnInitializedAsync()
    {
        var request = await PostClient.ListBookMark();
        PostDtos = request.Value;
        _isAuthChecked = true;
    }

    public async Task HandleBookMark(int? PostId)
    {
        addBookMarkRequest.PostId = PostId;
        await PostClient.AddBookMark(addBookMarkRequest);
        var bookmark = await PostClient.ListBookMark();
        PostDtos = bookmark.Value;
    }
}