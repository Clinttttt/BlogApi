@page "/"
@using BlogApi.Application.Dtos
@using BlogApi.Client.Interface
@inject IUserClientServices ClientService
@rendermode InteractiveServer

<main class="p-6 lg:p-12 max-w-7xl w-full overflow-auto h-screen">

    <header class="flex flex-col lg:flex-row justify-between items-start gap-6 mb-12 pb-8 border-b-1 border-gray-300">
        <div>
            <h1 class="text-2xl lg:text-3xl font-semibold text-gray-700 mb-2">Developer Learning Journal</h1>
            <p class="text-base text-gray-600">Sharing my journey through .NET, Blazor, and Modern Web Development</p>
        </div>
        <div class="flex gap-4">

            <NavLink href="profile" class="flex-shrink-0 cursor-pointer border rounded-full border-gray-400 w-10 aspect-square overflow-hidden">             
                @if (userProfile?.PhotoUrl is null)
                {
                    <img src="/img/icon-proff.png" class="w-full h-full object-contain " />
                }
                else
                {
                    <img src="@userProfile.PhotoUrl" class="w-full h-full object-cover " />
                }
                </NavLink>
                
            <input type="text" placeholder="🔍 Search" class="flex w-[100%] items-center gap-2  px-3 py-1.5 bg-white text-gray-700 border border-gray-300 rounded-lg font-semibold hover:bg-gray-50 transition-all whitespace-nowrap" />
            <button class=" cursor-pointer flex items-center gap-2 text-xs px-3 py-1.5 bg-blue-500  text-white rounded-lg font-semibold hover:bg-blue-700 hover:-translate-y-0.5 transition-all whitespace-nowrap">
                New Post
            </button>
            <NavLink href="bookmark" class="btn btn-square self-center">
                <svg class="w-[26px] h-[26px] text-indigo-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.4" d="m17 21-5-4-5 4V3.889a.92.92 0 0 1 .244-.629.808.808 0 0 1 .59-.26h8.333a.81.81 0 0 1 .589.26.92.92 0 0 1 .244.63V21Z" />
                </svg>

            </NavLink>
        </div>
    </header>

    <section class="relative overflow-hidden bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl p-8 lg:p-12 text-white mb-12">
        <div class="inline-block bg-white/20 px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider mb-6">
            Featured
        </div>
        <h2 class="text-3xl lg:text-4xl font-bold mb-4 leading-tight">
            Implementing Google Authentication in Blazor Server with .NET Core
        </h2>
        <p class="text-lg leading-relaxed opacity-95 mb-6 max-w-3xl">
            Learn how to integrate Google OAuth authentication in your Blazor Server application,
            including setup, configuration, and best practices for secure user management.
        </p>
        <div class="flex flex-wrap gap-6 mb-8 text-sm">
            <span class="flex items-center gap-2">📅 December 18, 2025</span>
            <span class="flex items-center gap-2">⏱️ 8 min read</span>
            <span class="flex items-center gap-2">👁️ 1.2k views</span>
        </div>
        <NavLink href="@($"viewblog/{1}")" class="bg-white text-indigo-600 px-8 py-4 rounded-lg font-semibold text-base hover:-translate-y-0.5 hover:shadow-lg transition-all">
            Read Article →
        </NavLink>
    </section>


    <section class=" pt-5  border-t-1 border-gray-300">
        <h2 class="text-lg font-bold mb-6 text-gray-700">Recent Posts</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-6">

            <article class="bg-white rounded-2xl p-6 border border-gray-200 hover:-translate-y-1 hover:shadow-xl hover:border-blue-600 transition-all cursor-pointer">
                <div class="flex justify-between items-center mb-4">
                    <span class="bg-blue-50 text-blue-600 px-3 py-1.5 rounded-md text-xs font-semibold uppercase">CQRS</span>
                    <span class="text-sm text-gray-600">Dec 15, 2025</span>
                </div>
                <h3 class="text-xl line-clamp-2 font-bold mb-3 text-gray-700 leading-snug">
                    Getting Started with CQRS and MediatR in .NET
                </h3>
                <p class="text-gray-600 line-clamp-3 leading-relaxed mb-4 text-sm">
                    Discover how to implement Command Query Responsibility Segregation pattern
                    using MediatR library in your .NET applications.
                </p>
                <div class="flex justify-between items-center pt-4 border-t border-gray-200">
                    <span class="text-sm text-gray-600">⏱️ 6 min</span>
                    <NavLink href="admin/create-blog" class="text-blue-600 font-semibold text-sm hover:underline">Read more →</NavLink>
                </div>
            </article>


            <article class="bg-white rounded-2xl p-6 border border-gray-200 hover:-translate-y-1 hover:shadow-xl hover:border-blue-600 transition-all cursor-pointer">
                <div class="flex justify-between items-center mb-4">
                    <span class="bg-blue-50 text-blue-600 px-3 py-1.5 rounded-md text-xs font-semibold uppercase">Blazor</span>
                    <span class="text-sm text-gray-600">Dec 12, 2025</span>
                </div>
                <h3 class="text-xl  line-clamp-2 font-bold mb-3 text-gray-700 leading-snug">
                    Building Real-time Features with Blazor Server
                </h3>
                <p class="text-gray-600 line-clamp-3 leading-relaxed mb-4 text-sm">
                    Explore SignalR integration and real-time capabilities in Blazor Server
                    applications for interactive user experiences.
                </p>
                <div class="flex justify-between items-center pt-4 border-t border-gray-200">
                    <span class="text-sm text-gray-600">⏱️ 10 min</span>
                    <button class="text-blue-600 font-semibold text-sm hover:underline">Read more →</button>
                </div>
            </article>


            <article class="bg-white rounded-2xl p-6 border border-gray-200 hover:-translate-y-1 hover:shadow-xl hover:border-blue-600 transition-all cursor-pointer">
                <div class="flex justify-between items-center mb-4">
                    <span class="bg-blue-50 text-blue-600 px-3 py-1.5 rounded-md text-xs font-semibold uppercase">Web API</span>
                    <span class="text-sm text-gray-600">Dec 10, 2025</span>
                </div>
                <h3 class="text-xl line-clamp-2 font-bold mb-3 text-gray-700 leading-snug">
                    RESTful API Design Best Practices
                </h3>
                <p class="text-gray-600 line-clamp-3 leading-relaxed mb-4 text-sm">
                    Learn essential principles and patterns for designing clean, maintainable,
                    and scalable RESTful APIs with .NET Core.
                </p>
                <div class="flex justify-between items-center pt-4 border-t border-gray-200">
                    <span class="text-sm text-gray-600">⏱️ 12 min</span>
                    <NavLink href="editor" class="text-blue-600 font-semibold text-sm hover:underline">Read more →</NavLink>
                </div>
            </article>


            <article class="bg-white rounded-2xl p-6 border border-gray-200 hover:-translate-y-1 hover:shadow-xl hover:border-blue-600 transition-all cursor-pointer">
                <div class="flex justify-between items-center mb-4">
                    <span class="bg-blue-50 text-blue-600 px-3 py-1.5 rounded-md text-xs font-semibold uppercase">Authentication</span>
                    <span class="text-sm text-gray-600">Dec 8, 2025</span>
                </div>
                <h3 class="text-xl line-clamp-2 font-bold mb-3 text-gray-700 leading-snug">
                    JWT Authentication in .NET Core Web API
                </h3>
                <p class="text-gray-600  line-clamp-3 leading-relaxed mb-4 text-sm">
                    Implement secure JWT-based authentication and authorization in your
                    .NET Core Web API applications.
                </p>
                <div class="flex justify-between items-center pt-4 border-t border-gray-200">
                    <span class="text-sm text-gray-600">⏱️ 9 min</span>
                    <NavLink href="@($"viewblogconstruct/{11}")" class="text-blue-600 font-semibold text-sm hover:underline">Read more →</NavLink>
                </div>
            </article>
        </div>
    </section>
</main>

          





@code {
    private UserProfileDto? userProfile { get; set; } = new UserProfileDto();
    public bool hasrender = false;
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!hasrender && firstRender)
        {
            hasrender = true;
            var request = await ClientService.GetCurrentUser();    
            if(request is not null)
            userProfile = request.Value;         
        }
        StateHasChanged();
    }
}



















@*page "/"
@using BlogApi.Application.Dtos
@using BlogApi.Application.Request.Category
@using BlogApi.Application.Request.Tag
@using BlogApi.Client.Interface
@using BlogApi.Client.Security
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage
@inject ITagClientService TagService
@inject AuthStateProvider AuthStateProvider
@rendermode InteractiveServer
@inject ICategoryClientService TagClient

<PageTitle>Test Tags - Auth Check</PageTitle>

<h3>Authentication & Tags Test</h3>

<div class="auth-status mb-4">
 
</div>

<hr />

<h4>Tags List (AllowAnonymous)</h4>

@if (isLoading)
{
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
    <p>Loading tags...</p>
}
else if (errorMessage != null)
{
    <div class="alert alert-danger">
        <strong>Error:</strong> @errorMessage
    </div>
}
else if (tags != null && tags.Any() && ListCateg != null && tags.Any())
{
    <div class="alert alert-success">
        <strong>Success!</strong> Found @tags.Count tag(s)
    </div>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var tag in tags)
            {
                <tr>
                    <td>@tag.Id</td>
                    <td>@tag.Name</td>
                </tr>
            }
            @foreach (var cat in ListCateg)
            {
                <tr>
                    <td>@cat.Id</td>
                    <td>@cat.Name</td>
                </tr>
            }
        </tbody>
    </table>
    <EditForm Model="AddCateg" OnValidSubmit="HandleCategory" FormName="AddTagni">

        <InputText @bind-Value="AddCateg.Name"  DisplayName="AddCat" placeholder="Enter Cat name" />
        <button class="btn" type="submit">Add Category</button>

   </EditForm>
}
else
{
    <div class="alert alert-info">
        No tags found.
    </div>
}
@inject IJSRuntime JS

<button @onclick="CheckStorage" class="btn btn-primary">Check Storage</button>

@code {
    private async Task CheckStorage()
    {
        var token = await JS.InvokeAsync<string>("localStorage.getItem", "AccessToken");
        Console.WriteLine($"Token exists: {!string.IsNullOrEmpty(token)}");
        Console.WriteLine($"Token length: {token?.Length}");
    }
}
@code {
    private List<TagDto>? tags;
    private bool isLoading = true;
    private string? errorMessage;
    private bool _hasLoaded = false;
    public AddTagRequest AddTag { get; set; } = new();
    public AddCategoryRequest AddCateg { get; set; } = new();
    private List<CategoryDto>? ListCateg;

    public async Task HandleAddTag()
    {
        if (!string.IsNullOrEmpty(AddTag.Name))
        {
            var request = await TagService.Create(AddTag);
        }

        Console.WriteLine("Success");
        await LoadTags();
        StateHasChanged();
    }
    public async Task HandleCategory()
    {
        if (!string.IsNullOrEmpty(AddCateg.Name))
        {
            var request = await TagClient.Create(AddCateg);
        }
         Console.WriteLine("Success cat");
        await LoadTags();
        StateHasChanged();
    }


    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && !_hasLoaded)
        {
            _hasLoaded = true;

            // Initialize auth state
            await AuthStateProvider.InitializeAsync();

            // Small delay to ensure JavaScript interop is fully ready
            await Task.Delay(100);

            // Then load data
            await LoadTags();

            StateHasChanged(); // Refresh the UI
        }
    }

    private async Task LoadTags()
    {
        try
        {
            isLoading = true;
            errorMessage = null;

            var result = await TagService.GetAllTags();
            var cat = await TagClient.GetListing();
            if (result.IsSuccess && result.Value != null && cat.IsSuccess && cat.Value != null)
            {
                tags = result.Value;
                ListCateg = cat.Value;
            }
            else
            {
                errorMessage = "Failed to load tags. Result was not successful.";
            }
        }
        catch (Exception ex)
        {
            errorMessage = $"Exception: {ex.Message}";
        }
        finally
        {
            isLoading = false;
            StateHasChanged(); // Ensure UI updates
        }
    }
}*@