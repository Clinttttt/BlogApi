@page "/author"




<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 h-screen overflow-auto pb-15">

  
        <div class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">Welcome back, Author! </h1>
                    <p class="text-gray-600">Manage your posts and content</p>
                </div>
                <NavLink href="create-post"
                         class="bg-indigo-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors flex items-center gap-2 shadow-lg hover:shadow-xl">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    Create New Post
                </NavLink>
            </div>

         
        </div>

        <div class="flex flex-col md:flex-row md:space-y-0 md:space-x-1 justify-between bg-white rounded-2xl shadow-sm p-4 mb-6 ">
            <div class="flex gap-1">
                <button @onclick="() => PageState.AuthorView(PageState.AuthorPostState.all_post)" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-500 hover:bg-indigo-500 hover:text-white cursor-pointer transition-colors ">
                    All Posts
                </button>
                <button @onclick="() => PageState.AuthorView(PageState.AuthorPostState.published)" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-500 hover:bg-indigo-500 hover:text-white cursor-pointer transition-colors ">
                    Published
                </button>
                <button @onclick="() => PageState.AuthorView(PageState.AuthorPostState.pending)" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-500 hover:bg-indigo-500 hover:text-white cursor-pointer transition-colors ">
                    Pending Approval
                </button>
                <button @onclick="() => PageState.AuthorView(PageState.AuthorPostState.drafts)" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-500 hover:bg-indigo-500 hover:text-white cursor-pointer transition-colors ">
                    Drafts
                </button>
            </div>
           <div class="flex gap-2">

                <label class="input input-bordered flex items-center gap-2 w-[100%]">
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <input type="text" class="w-[100%]" placeholder="Search posts..." />
                </label>

                <button @onclick="() => PageState.AuthorView(PageState.AuthorPostState.bookmarks)" class="btn btn-ghost btn-square bg-indigo-50 hover:bg-indigo-50">
                    <svg class="w-6 h-6 text-indigo-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.4" d="m17 21-5-4-5 4V3.889a.92.92 0 0 1 .244-.629.808.808 0 0 1 .59-.26h8.333a.81.81 0 0 1 .589.26.92.92 0 0 1 .244.63V21Z" />
                    </svg>
                </button>
           </div>
        </div>

        @if (PageState.AuthorPageView == PageState.AuthorPostState.all_post)
        {
            <Featured featuredPosts="featuredPosts" ReadMore="HandleReadMore" />
            <AllPosts recentPost="recentPost" Pagination="Pagination" Refresh="RefreshAsync" />

        }
        else if (PageState.AuthorPageView == PageState.AuthorPostState.drafts)
        {

            <Drafts />

        }
        else if (PageState.AuthorPageView == PageState.AuthorPostState.pending)
        {

            <Pending />

        }
        else if (PageState.AuthorPageView == PageState.AuthorPostState.published)
        {

            <Blog.Client.Components.Pages.Author.Components.Published  />

        }
        else if (PageState.AuthorPageView == PageState.AuthorPostState.bookmarks)
        {

            <BookMarks />

        }
    </div>
</div>

<style>
    .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .hide-scrollbar::-webkit-scrollbar {
        display: none;
    }

    .hide-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

</style>



@code {

    private List<FeaturedPostDto>? featuredPosts { get; set; } = new List<FeaturedPostDto>();
    private PagedResult<PostDto>? recentPost { get; set; } = new PagedResult<PostDto>();
    private ListPaginatedRequest Pagination { get; set; } = new ListPaginatedRequest();


    protected override async Task OnInitializedAsync()
    {
        var listfeature = ListFeatured();
        var listpublished = ListPublished();
        await SignalR.InitializeAsync();

        await Task.WhenAll(listfeature,listpublished);
        OnViewCountUpdate();

    }

    public void OnViewCountUpdate()
    {
        SignalR.OnViewCountUpdate((postId, viewCount) =>
{
    var post = featuredPosts?.FirstOrDefault(p => p.PostId == postId);
    if (post != null)
    {
        post.ViewCount = viewCount;
        InvokeAsync(StateHasChanged);
    }
});
    }

    public async Task RefreshAsync()
    {
        var recent = await PostClient.ListPublished(Pagination);
        recentPost = recent.Value;
        StateHasChanged();
    }

    private async Task ListFeatured()
    {
        var feaatured = await PostClient.ListFeatured();
        featuredPosts = feaatured.Value;
    }

    private async Task ListPublished()
    {
        var recent = await PostClient.ListPublished(Pagination);
        recentPost = recent.Value;
    }

    public async Task HandleReadMore(int? Id)
    {
        await PostClient.TrackPostView(Id);
        Navigation.NavigateTo($"viewblogconstruct/{Id}");
        StateHasChanged();
    }
}